---
allowed-tools: Bash(npm:*), Bash(pnpm:*), Bash(git:*), Read, Edit, MultiEdit, Grep, Task, TodoRead, TodoWrite
description: 分析代码的性能问题并建议优化方案
---

## 上下文

- **当前 git 状态**: !`git status --porcelain`
- **当前分支**: !`git branch --show-current`
- **最近提交**: !`git log --oneline -5`

## 任务

### 1. 性能优化

- **算法优化**: 分析时间/空间复杂度，优化循环和递归
- **内存管理**: 检测内存泄漏，优化数据结构使用
- **异步优化**: 并发处理，避免阻塞操作
- **缓存策略**: 识别重复计算，实施缓存机制
- **懒加载**: 延迟加载非关键资源

### 2. 代码质量优化

- **重复代码消除**: 应用 DRY 原则，提取公共函数
- **复杂度降低**: 拆分大函数（>30行），降低圈复杂度（<10）
- **死代码清理**: 删除无法访问的代码

### 3. 架构优化

- **模块化**: 拆分大文件（>300行），单一职责原则
- **解耦**: 减少模块间依赖，使用依赖注入
- **设计模式**: 应用合适的设计模式改善结构

### 4. 错误处理与健壮性

- **异常捕获**: 添加 `try-catch`，使用 `Promise.catch`
- **边界处理**: 验证输入，处理 null/undefined（`?.`、`??`）
- **容错设计**: 实现重试机制，添加降级策略
- **日志优化**: 添加关键节点日志，避免日志污染

### 5. 前端特定优化

- **渲染优化**: 虚拟滚动，防抖节流，React.memo/Vue.computed
- **打包优化**: 代码分割，tree-shaking，压缩优化
- **网络优化**: 请求合并，资源预加载，CDN使用
- **状态管理**: 优化 store 结构，避免不必要的重渲染

### 6. 后端特定优化

- **数据库优化**: 索引优化，查询优化，连接池配置
- **API优化**: 分页处理，响应压缩，GraphQL查询优化
- **并发处理**: 线程池优化，异步队列，负载均衡

### 7. 验证与测试

- **性能基准**: 建立性能基线，对比优化前后
- **回归测试**: 确保功能不受影响
- **负载测试**: 验证高并发场景表现

## 约束

- 先获取现有模板，完整分析后提供改进建议
- 所有优化都要基于实际需求和最佳实践
- 应用 CLAUDE.md 中学习的经验和技巧
- 优化后直接建立新版本，不修改原有模板
